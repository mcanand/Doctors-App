<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <template id="homepage_inherit" inherit_id="website.homepage">
        <xpath expr="//div[@id='wrap']" position="replace">

            <!-- use this method to add content to the nav bar -->
            <t t-set="app_nav_in_content">
                <span class="poppins300" style="font-size:13px;color:#666;">
                    Welcome
                </span>
                <br/>
                <span class="poppins600">
                    <t t-esc="request.env.user.name"/>
                </span>
            </t>
            <!-- ==================== ============== -->
            <!--            <t t-set="app" t-value="requset.env[]"-->
            <t t-set="user_partner_id" t-value="request.env.user.partner_id"/>

            <t t-set="bookings" t-value="request.env['doctor.time.slots'].sudo().search([
    ('partner_ids', 'in', user_partner_id.ids),
    ('booking_button', '=', True),
    ('date','=',datetime.datetime.now().strftime('%Y-%m-%d'))

])"/>
            <t t-set="booking_details" t-value="[]"/>
            <t t-foreach="bookings" t-as="booking">
                <t t-set="booking_dict" t-value="{
        'doctor_name': booking.doctor_id.name,
        'from_time': booking.from_time,
        'dep_name' :booking.doctor_id.department_id.name,
        'doctor_image':booking.doctor_id.image_1920,

    }"/>
                <t t-set="booking_details" t-value="booking_details + [booking_dict]"/>
            </t>

            <div class="container" style="maximum-width:1500px;" id="wrap">
                <div class="row mt-3">
                    <div class="col-9 poppins500 app_color">
                        Today's<br/>Appointments
                    </div>
                    <div class="col-3 text-end app_color">
                        see all
                    </div>
                </div>

                <div class="appointment-container mt-3">
                    <t t-foreach="booking_details" t-as="appointment">
                        <div class="appointments-box">

                            <div class="appointment-details">
                                <div class="doctor-info">
                                    <div class="small-box">
                                        <img t-attf-src="data:image/png;base64,{{appointment.get('doctor_image')}}"/>
                                    </div>
                                    <div class="name">
                                        <t t-esc="appointment.get('doctor_name')"/>
                                    </div>
                                </div>
                                <div class="doctor-info">
                                    <div class="departments">
                                        <t t-esc="appointment.get('dep_name')"/>
                                    </div>
                                    <div class="rating">Rating: 4.5</div>
                                </div>
                                <div class="time-icon">
                                    <i class="fa fa-clock-o"></i>
                                    Today
                                    <t t-esc="appointment.get('from_time')"/>
                                </div>
                            </div>

                        </div>
                    </t>
                    <t t-if="not booking_details">
                        <div class="col-9 poppins500 app_color">
                            No Appointments Today
                        </div>
                    </t>

                </div>


                <div class="row mt-3">
                    <div class="col-12">
                        <a href="/departments" class="btn shadow-none app_card w-100 poppins400">View all departments
                        </a>
                    </div>
                </div>
                <br/>
                <div class="row">

                    <div class="col-9 poppins500 app_color">
                        Top-Rated<br/>Doctors
                    </div>
                </div>


                <t t-set="doctor_ratings"
                   t-value="env['doctor.rating'].search([], order='rating DESC', limit=5)"/>

                <div class="row">
                    <div class="col-24 doctor-container">
                        <t t-foreach="doctor_ratings" t-as="rating">

                            <button class="doctor-box">
                                <div class="doctor-information">
                                    <div class="image-box">
                                        <img t-attf-src="data:image/png;base64,{{rating.doctor_id.image_1920}}"
                                             alt="Doctor Image"/>
                                    </div>
                                    <div class="doctor-name">
                                        <t t-esc="rating.doctor_id.name"/><br/>
                                        <div class="department-name">
                                        <t t-esc="rating.doctor_id.department_id.name"/>
                                    </div>
                                    </div>

                                    <div class="doctor-rating"><span>Rating :</span>
                                        <t t-esc="rating.rating"/>
                                    </div>
                                </div>
                            </button>
                        </t>
                    </div>
                </div>

                <div class="row mt-3">
                    <div class="col-12">
                        <a href="/departments" class="btn shadow-none app_card w-100 poppins400">View all doctors
                        </a>
                    </div>
                </div>
            </div>
        </xpath>
    </template>
</odoo>
